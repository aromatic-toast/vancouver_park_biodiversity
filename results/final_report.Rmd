---
title: "Biodiversity in Vancouver Parks"
author: "Lesley Miller"
date: "07/06/2020"
output: 
  html_document:
    toc: true
    pandoc_args: --webtex
always_allow_html: true
bibliography: citations.bib
runtime: shiny
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_knit$set(root.dir = here::here())
library(shiny)
suppressPackageStartupMessages(library(tidyverse))
library(sf)
library(knitr)
library(gridExtra)
library(grid)
```

```{r load_data}
# load gbif
gbif <- st_read('data/clean_data/vancouver_gbif.shp', quiet = TRUE)

# load all parks w/metrics 
parks <- read_csv("data/clean_data/all_parks_with_metrics.csv", col_types = cols())
parks <- parks %>% 
      select(park_name, species_count, species_richness)

# load clipped_gbif
clipped_gbif <- st_read('data/clean_data/clipped_gbif.shp', quiet = TRUE)
clipped_gbif <- clipped_gbif %>% 
      rename(basis_of_record = basis_of_r)

# load outlier parks
outlier_parks <-  st_read('data/clean_data/park_outliers.shp', quiet = TRUE)
outlier_parks <- outlier_parks %>% 
      rename(park_primary_use = park_prima,
             species_counts = species_co,
             species_richness = species_ri )

# load parks with no outliers 
parks_with_no_outliers <- st_read('data/clean_data/parks_with_no_outliers.shp', quiet = TRUE)
parks_with_no_outliers <- parks_with_no_outliers %>% 
      rename(park_primary_use = park_prima,
             species_counts = species_co,
             species_richness = species_ri)
```


## Introduction

```{r park_use}
park_use <- tibble(Use_Table = unique(parks_with_no_outliers$park_primary_use))
kable(park_use, caption = "Primary Uses of Vancouver Parks")
```


## Data Sources {.tabset .tabset-pills}

### GBIF Data
```{r gbif_data}
# DataTables example
  shinyApp(
    ui = fluidPage(
      fluidRow(
        column(12,
          dataTableOutput('table1')
        )
      )
    ),
    server = function(input, output) {
      output$table1 <- renderDataTable(head(clipped_gbif,10))
    }
  )

```

### Parks Data
```{r parks_data}

# DataTables 
  shinyApp(
    ui = fluidPage(
      fluidRow(
        column(12,
          dataTableOutput('table2')
        )
      )
    ),
    server = function(input, output) {
      output$table2 <- renderDataTable(parks_with_no_outliers)
    }
  )

```

## Kepler Map 
```{r}
knitr::include_url("https://yihui.org")
```


## Results {.tabset .tabset-pills}

### No Outliers

```{r}
knitr::include_graphics("results/no_outliers.png")
```


### Outliers
```{r}
include_graphics("results/outliers.png")
```


## Tables 
```{r top_metrics}

# DataTables 
  shinyApp(
    ui = fluidPage(
      fluidRow(
        column(12,
          dataTableOutput('table3')
        )
      )
    ),
    server = function(input, output) {
      output$table3 <- renderDataTable(head(parks, 10))
    }
  )
```

# Analysis Methods 

This analysis was carried out with the amazing help from the following open source R packages: R [@R], tidyverse [@tidyverse], here [@here], gridExtra [@gridExtra] and sf [@sf]. And the following Python packages: Python [@Python], NumPy [@oliphant2006guide], GeoPandas [@geopandas0.7.0], Pandas [@pandas] and kepler.gl [@keplergl].

# References
